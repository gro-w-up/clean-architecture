# 14장. 컴포넌트 결합

ADP : 의존성 비순환 원칙
> 컴포넌트 의존성 그래프에 순환이 있어서는 안 된다.

`숙취 증후군` : 의존하고 있던 무언가 수정되어 기존 프로그램이 영향을 받는 현상

`해결책`
### 주단위 빌드
- 장점
  - 일주일의 첫 4일 동안은 서로 상관하지 않는다. 
- 단점 
  - 프로젝트가 커지면 금요일 하루만에 끝마치는 것이 어려움.
    - 배포 시작일이 목요일이 되어야 함을 인지
    - 통합에 드는 시간이 늘어나며 효율이 나빠짐 
### 순환 의존성 제거하기
  - 장점
    - 개발환경을 릴리스 가능한 컴포넌트 단위로 분리하는 것
      - 개인별 또는 팀이 책임질 수 있는 작업 단위가 될 수 있음.
  - 단점
    - 의존성 구조를 반드시 관리해야하는 어려움이 있음.

🤔
순환 의존성 제거하는 방법은 의존성 화살표를 거꾸로 따라가서 빌드 순서가 정해지게 되는데
만약 여러 컴포넌트를 빌드해야한다면 의존 관계에 있는 맨 마지막 컴포넌트는 **유휴시간**을 가지게 되는 것이 아닐까?

### 순환이 컴포넌트 의존 그래프에 미치는 영향

`순환 끊기`
- DIP(의존성 역전 원칙)를 적용하여 해결한다.
> 그림 14.3 Entities와 Authorizer 사이의 의존성을 역전시킨다. 참고
- 유저가 필요로하는 메서드를 제공하는 인터페이스 Premissions 생성 
- Authorizer는 이 인터페이스를 상속 받는다.

`흐트러짐`
- 요구사항이 변경되면 컴포넌트 구조도 변경될 수 있다.
- 순환을 항상 관찰해야 하고 어떤 식으로든 끊어야한다.

### 하향식 설계

SDP : 안정된 의존성 원칙
> 안정성의 방향으로(더 안정된 쪽에) 의존하라.

- 변경이 쉽지 않은 컴포넌트가 변동이 예상되는 컴포넌트에 의존하게 만들어서는 절대로 안 된다.
- 소프트웨어의 괴팍함 ㅋㅋ
  - 만들 때는 변경하기 쉽도록 설계했지만 이 모듈에 누군가가 의존성을 매달아버리면 모듈을 변경하기 어려워진다.

`안정성`
- 동전 예시를 통해 안정적은 '쉽게 움직이지 않는'것을 이해.
- 그림 14.5 X는 안정된 컴포넌트다.
  - 3개의 컴포넌트가 X에 의존하고 있다.
  - X는 3개의 컴포넌트를 **책임진다**라고 말한다.
  - X는 어디에도 의존하지 않음으로 X가 변경되도록 만들 수 있는 영향이 없기 때문에 독립적이라고 말한다.
- 그림 14.6 Y는 상당히 불안정한 컴포넌트다.
  - Y를 의존하는 컴포넌트가 없어 Y는 책임성이 없다.
  - 외부 세 컴포넌트가 변경이 되는 경우 영향을 받기 떄문에 의존적이라고 한다.

`안정성 지표`
- `Fan-in` : 안으로 들어오는 의존성.
  - 컴포넌트 내부의 클래스에 의존하는 컴포넌트 외부 클래스 개수를 나타낸다.
- `Fan-out` : 바깥으로 나가는 의존성.
  - 컴포넌트 외부의 클래스에 의존하는 컴포넌트 내부의 클래스 개수를 나타낸다.
- `I(불안정성)` : I = Fan-out / (Fan-in + Fan-out)
  - I=0 안정성이 높다. I=1 불안정하다.
  - X는 I = 0 / (3 + 0) = 0 임. 안정성이 높다.
  - Y는 I = 3 / (0 + 3) = 1 임. 불안정하다.

### SAP : 안정된 추상화 원칙
> 컴포넌트는 안정된 정도만큼만 추상화되어야 한다.
- 시스템에서 고수준 정책을 캡슐화하는 소프트웨어는 반드시 안정된 컴포넌트(I=0)에 위치해야한다.
- 불안정한 컴포넌트(I=1)는 반드시 변동성이 큰 소프트웨어, 즉 쉽고 빠르게 변경할 수 있는 소프트웨어만을 포함해야한다.

**추상화 정도 측정하기**
- Nc : 컴포넌트의 클래스 개수
- Na : 컴포넌트의 추상 클래스와 인터페이스의 개수
- A: 추상화 정도. A = Na / Nc
> A 지표는 0과 1사이의 값을 갖는다. A가 0이면 컴포넌트에는 추상 클래스가 하나도 없다는 뜻이다.
> A가 1이면 컴포넌트는 오로지 추상 클래스만을 포함한다는 뜻이다.

**주계열**
안정성과 추상화 정도 사이의 관계를 정의

- 그림 14.12 A/I 그래프
  - (0,0) 고통의 구역
    - 구체적이고 많은 컴포넌트가 의존한다.
    - ex. 데이터베이스 스키마
  - (1,1) 쓸모없는 구역
    - 폐기물 

**주계열과의 거리**
- D^4 : 거리, D = |A + I - 1|
- D가 0이면 컴포넌트가 주 계열 바로 위에 위치한다는 뜻
- D가 1이면 주계열로부터 가장 멀리 위치한다는 뜻

컴포넌트는 주계열 바로 위 또는 가깝게 위치할 때 가장 이상적이다.